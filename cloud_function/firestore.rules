rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 주식 기본 정보: 모두 읽기 가능, Cloud Function만 쓰기
    match /stocks/{code} {
      allow read: if true;
      // 이 'false'는 클라이언트 SDK를 통한 직접 쓰기를 막습니다.
      // Cloud Functions에서 Admin SDK를 사용하면 이 규칙을 우회하여 쓰기 가능합니다.
      allow write: if false;
    }

    // 월별 데이터: 모두 읽기 가능, Cloud Function만 쓰기
    match /stocks/{code}/monthly/{month} {
      allow read: if true;
      allow write: if false;
    }

    // 사용자 문서: 본인만 접근
    match /users/{userId} {
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;

      // 가로선: 본인만 접근 (핵심!)
      match /lines/{lineId} {
        allow read, write: if request.auth != null
                           && request.auth.uid == userId;
      }
    }

    // 메타데이터: 모두 읽기 가능
    match /metadata/{document} {
      allow read: if true;
      allow write: if false;
    }
  }
}
